<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Many-Task Computing with Python</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">

	<!-- <link rel="stylesheet" href="css/screen.css"> -->
	<style>
	@import url(css/screen.css);
	@import url(css/tmp.css);
	@import url(css/styles/default.css);
	</style>

	<script src="js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

</head>
<body class="list">

<header class="caption">
	<h1>Many-Task Computing with Python</h1>
	<p>Monte Lunacek</p>
	<p>University of Colorado <b>Boulder</b></p>
</header>

<section class="slide cover">
	<div>
		<h2>Many-Task Computing with Python</h2>
		<p>Monte Lunacek</p>
		<p>Thomas Hauser</p>
		<br>
		<br>
		<p>https://github.com/mlunacek/data_science_meetup_2013</p>
	</div>
	<div class="footer">Research Computing, University of Colorado <b>Boulder</b></div>
</section>
<!-- beginning of slides -->

<section class="slide"><div>
<h2>Outline</h2>

<ol>
<li>High Performance Computing
<ul>
	<li>Current types of applications</li>
	<li>Define Many-task computing</li>
</ul>
</li>
<li>Why Python for HPC?
	<ul>	
	<li>Key packages for scientific computing</li>
	<li>Abstraction</li>
	</ul>
	</li>
<li>Many-task computing with Python
<ul><li>Scaling</li> </ul>
</li>
</ol>
Conclusions, questions
</div></section>

<section class="slide"><div>
<h2>Goals</h2>

<ol>
<li>Understand the landscape of HPC</li>
<li>Links to key packages</li>
<li>Tools
	<ul>	
	<li>Notebook</li>
	<li>Easy parallelism</li>
	</ul>
	</li>
<li>Lots of examples<ul>	
	<li>Learn something useful</li>
	<li>Download and try it!</li>
	</ul>
	</li></ol>
</div></section>


<section class="slide sub">
<div>
<img src="img/parallel.png" style="margin:30px auto;display:block; height:400px"  alt="some_text">	
<h2>High Performance Computing</h2>
</div>
</section>

<section class="slide">
<div>
<h2>Using applications to solve problems</h2>

<ol>
<li>Size<ul>
	<li>Solve problems that can't fit on a laptop  </li>
	<li>Need more than a few GB of RAM</li>
	<li>Need more than a few hundred GB of Disk</li>
	</ul>
</li>
<li>Speed<ul>
	<li>Same problem, faster</li>
	<li>Makes a bigger problem more feasible</li>
	</ul>
</li>

<p class="cite">Henry Neeman, <a href="http://www.oscer.ou.edu/education.php">Super Computing in Plain English</a></p>

</ol>

</div>
</section>

<section class="slide">
<div>
<h2><strong>Supercomputing</strong></h2> 	

<div class='col3 right'>
<img src="img/infiniband.png" style="margin:0px auto;display:block; height: 300px;"  alt="img/infiniband.png">	
</div>

<div class='col4'>
<ul>
<li>Definition changes daily!</li>
<li>Cluster of computers linked together</li>
<li>100x bigger, faster, better than a PC</li>
</ul>
</div>


</div>
</section>


<section class="slide">
<div>

<h2> <strong>Janus</strong> macbook comparison</h2>

<img src="img/janus.png" style="margin:10px auto;display:block; height: 250px;"  alt="img/janus.png">	

<table class="table table-bordered table-striped">
	<thead>
	<tr>
		<th>Macbook</th>
		<th>Janus</th>
		<th></th>
	</tr>
	</thead>	
	<tr>
	    <td>2.4 GHz Intel x2</td>
	    <td>2.8 GHz Intel x12 X 1360</td>
	    <td>~8000X</tr>
	</tr>
	<tr>
	    <td>8 GB RAM</td>
	    <td>24 GB RAM</td>
	     <td>~4000X</td>
	</tr>
	<tr>
	    <td>3 M cache</td>
	    <td>12 M cache</td>
	    <td></td>
	</tr>
</table>

</section>
</div>


<section class="slide">
<div>
<h2><strong>Parallel</strong> Computing</h2>

<div class="col2 left">
	<p><strong>Traditional</strong></p>	
	<p>Shared Memory: OpenMP</p>
	<p>Distributed: MPI</p>
	<p>Accelerator: OpenACC, CUDA</p>
	<p>Hybrid</p>
</div>

<div class="col2 left">
	<p><strong>New</strong></p>
	<p>MapReduce</p>
	<p>Message brokers: AMQP, ZeroMQ</p>
</div>

<div class="col4">
<br>
<ul>
<li>Solve a different problem</li>
<li>Offer a different set of characteristics</li>
</ul>	
</div>

</div>
</section>


<section class="slide">
<div>
<h2>Landscape of Applications</h2>

<img src="img/MTC.svg" style="margin:10; auto;display:block; height: 450px;">
<p class="cite">Ioan Raicu, <a href="http://datasys.cs.iit.edu/publications/2009_PhD-UChicago_dissertation.pdf">Many-Task Computing: Bridging the Gap between High Throughput Computing and High Performance Computing</a></p>
</div>
</section>

<section class="slide">
<div>
<h2>Comparing MTC and HTC</h2>
<ul>
<li>
<strong>Many-task Computing</strong>  (MTC)
<ul><li>Use a large resources over a short period</li>
	<li>May not be single-core and independent</li>
	<li><em>Peformance per second</em></li>
</ul>

<li>
<strong>High-throughput Computing</strong>  (HTC)
<ul>
	<li>Operations per month</li>
</ul>
</li>
</ul>
	
<blockquote>
<p>Applications that are communication-intensive but are not naturally expressed in MPI.  -Ioan Raicu </p>
</blockquote>

</div>
</section>

<section class="slide">
<div>
<h2>University of Colorado</h2>
<ul>
<li>Some tightly-coupled MPI codes</li>
<li>Many simulations
<ul>
	<li>Monte Carlo, parameter scans, UQ, parameter optimization</li>
	</ul>
</li>
<li>Diverse computing backgrounds
	<ul>
	<li>Geography, Ecology and Evolutionary Biology, Microbial Ecology,
		Geology, Astronomy</li>
	</ul>
</li>
<li>Range of computational experience</li>
</ul>

</div>
</section>



<section class="slide sub">
<div>
<img src="img/monty-python.png" style="margin:20px auto;display:block; height:400px"  alt="monty-python.jpg">	
<h2>Python for High Performance Computing</h2>
</div>
</section>


<section class="slide">
<div>

<div class="col13 left">	
<p><strong>Base</strong></p>

<p><code><a href="https://http://www.numpy.org"> numpy </a></code></p>
<p><a href="https://http://scipy.org"> scipy </a></p>
<p><a href="http://matplotlib.sourceforge.net/">matplotlib </a> </p>
<p><code><a href="http://ipython.org">ipython</a></code></p>
</div>

<div class="col13 left">	
<p><strong>Effciency</strong></p>
<p><a href="http://pypy.org">pyp</a></p>
<p><a href="http://numba.pydata.org/">numba</a></p>
<p><a href="http://www.scipy.org/F2py"> f2py</a></p>
<p><a href="http://docs.cython.org/">cython</a></p>
</div>

<div class="col13 left">
<p><strong>Parallel</strong></p>
<p><code><a href="http://ipython.org/ipython-doc/dev/parallel/">ipython parallel</a></code></p>
<p><a href="http://www.pytables.org/moin">celery </a></p>
<p><a href="http://discoproject.org/">scoop</a></p>
<p>and many more...</p>
</div>

<div class="col13 left">
<p><strong>Data</strong></p>
<p><code><a href="http://pandas.pydata.org/">pandas </a> </code></p>
<p><a href="http://www.pytables.org/moin">pytables </a></p>
<p><a href="http://discoproject.org/">disco</a></p>
<p><a href="http://spark.incubator.apache.org/">spark</a></p>
</div>



<div class="col13 left">
<p><strong>HPC</strong></p>
<p><a href="http://mpi4py.scipy.org/">mpi4py </a> </p>
<p><a href="http://docs.cython.org/src/userguide/parallelism.html">cython.parallel </a></p>
<p><code><a href="https://store.continuum.io/cshop/accelerate/">multiprocessing</a></code></p>
<p><a href="http://mathema.tician.de/software/pycuda">pycuda</a></p>
<p><a href="https://store.continuum.io/cshop/accelerate/">Accelerate</a></p>
</div>

<p class='cite' style="left:700px;">Andy Terrel<a href="http://andy.terrel.us/blog/2012/09/27/starting-with-python/">Getting started with Python in HPC</a>
</div>
</section>


<section class="slide">
<div>
<h2><strong>Success</strong> Stories</h2>

<p>~500,000 simulations on ~7,000 cores with <a href="http://mpi4py.scipy.org/">mpi4py </a> </p>
<p>Parameter optimization on ~100 cores with
	<a href="https://code.google.com/p/scoop/"> Scoop </a>
		and 
	<a href="https://code.google.com/p/deap/"> DEAP </a>	
	</p>
	
<p>Improved biological workflow with 
	<a href="http://ipython.org/ipython-doc/dev/parallel/"> IPython Parallel </a></p>
		
<p>Wrapped an engineering simulation with 		
	<a href="http://www.scipy.org/F2py"> f2py</a> and
	<a href="http://ipython.org/ipython-doc/dev/parallel/"> IPython Parallel </a>

<p>Packaged multiple MPI tasks with 
	<a href="http://jinja.pocoo.org/docs/"> Jinja2 </a>

<p>Benchmarking:
<a href="http://mpi4py.scipy.org/">mpi4py </a>,	
<a href="http://discoproject.org/"> pandas </a>,
<a href="http://jinja.pocoo.org/docs/"> Jinja2 </a>,
<a href="https://www.djangoproject.com/"> Django </a>

<br>
<br>
<p>Working on <strong>MapReduce</strong> with 
	<a href="http://discoproject.org/"> disco </a> and <a href="http://spark.incubator.apache.org/">spark</a>
</p>
<p>Working on <strong>Workflow</strong> with 
	<a href="http://networkx.github.com/"> NetworkX </a>, <a href="http://ipython.org/ipython-doc/dev/parallel/"> IPython Parallel </a>, and 
	<a href="https://code.google.com/p/scoop/"> Scoop </a>
</p>
</div>
</section>


<section class="slide"><div>
<h2>Why Python?</h2>

<ul>
<li>Flexible, powerful programming language</li>
<li>Easy to learn</li>
<li>Accessible to <em>non-programmers</em></li>
<li>Glue</li>
<li>Free and open</li>
<li>Large community</li>
<li><strong>Abstraction</strong></li>
</ul>

</div></section>

<section class="slide">
<div>
<h2>Numpy (MKL) and Pytables</h2>

<pre class="python"><code>import numpy as np
import tables as tb

def read_h5(filename):
    filename = filename
    h5 = tb.openFile(filename, mode = "r")
    X = h5.root.x.read()
    h5.close()
    return X

if __name__ == '__main__':

    args = get_args(sys.argv[1:])
	
	A = read_h5(args.matrixA)
	B = read_h5(args.matrixB)
	C = np.dot(A,B)
</code></pre>

</div>
</section>

<section class="slide">
<div>
<h2>2 reads, multiply, 1 write</h2>
<img src="img/matrix_multiply_compare.png" style="margin:5px auto; height:500px; display:block;">	
</div>
</section>

<section class="slide">
<div>
<h2>mpy4py</h2>

<pre class="python"><code>from mpi4py import MPI

comm = MPI.COMM_WORLD
rank = comm.Get_rank()

if rank == 0:
   
   data = {'key1' : [7, 2.72, 3.2],
           'key2' : ( 'abc', 'xyz')}
else:
   data = None
   
data = comm.bcast(data, root=0)
</code></pre>

</div>
</section>



<section class="slide sub">
<div>
<img src="img/manytask.png" style="margin:30px auto;display:block; height:400px"  alt="some_text">	
<h2>Many-Task Computing</h2>
</div>
</section>

<section class="slide">
<div>
<h2>Many-task Computing</h2>

<pre class="python"><code>#!/usr/bin/env python
import argparse, sys, time

def get_args(argv):
    parser = argparse.ArgumentParser()  
    parser.add_argument('-t','--time', help='e.g. --time=50')
    return parser.parse_args(argv)

def work(x):
    time.sleep(x)
    return x

if __name__ == '__main__':

    args = get_args(sys.argv[1:])
    work(float(args.time))
</code></pre>
<p style="margin-top: 10px;">What is the more efficient way to execute <em>work</em> a thousand times?</p>

<pre class="python"><code>python work.py --time=10
</code></pre>

</div>
</section>


<section class="slide">
<div>
<h2>Approach</h2>

Condor/Moab/SLURM
<br>
Bash/pbsdsh: painful example
<br>
MPI <strong>mpi4py</strong>: not exactly what we want
<br>
Python
<ul>
<li>SAGA BigJob</li>
<li><strong>multiprocessing</strong>: simple and included, example</li>
<li>Message broker: <strong>IPython parallel</strong>, Celery</li>
</ul>
<br> 
and many, many more ...
</div>
</section>


<section class="slide">
<div>
<h2>Bash/pbsdsh</h2>

<pre class="bash"><code>#!/bin/bash
PATH=$PBS_O_WORKDIR:$PBS_O_PATH
TRIAL=$(($PBS_VNODENUM + $1))
python work.py --time=5
</code></pre>

<br>

<pre class="bash"><code>for i in {1..N}
do
  pbsdsh wrapper.sh $count
  count=$(( $count + 12))
done
</code></pre>

<p> A little <strong>painful</strong></p>
</div>
</section>

<!-- <section class="slide">
<div>
<h2> A little <strong>inefficient</strong> </h2>
<img src="img/bash.svg" style="margin:0; auto;display:block; height: 325px;">
</div>
</section> -->

<section class="slide">
<div>
<h2> A little <strong>inefficient</strong> </h2>
<iframe src="http://bl.ocks.org/mlunacek/raw/6590169"></iframe>
</section>

<section class="slide">
<div>
<h2> <strong>MPI</strong> example</h2>

<img src="img/vw.png" style="height=100px; margin:0; auto;display:block;"  alt="some_text">	
</div>
</section>

<section class="slide">
<iframe src="http://nbviewer.ipython.org/6587193" seamless></iframe>
</section>

<section class="slide">
<iframe src="http://nbviewer.ipython.org/6570790"></iframe>
</section>


<section class="slide">
<div>
<h2> Message <strong>queues</strong></h2>

<img src="img/ipython.png" style="height=100px margin:10px auto;display:block;"  alt="some_text">		

<strong>elasticity</strong>, memory, fault-tolerance
</div>
</section>

<!--<section class="slide">-->
<!--<div>-->
<!--<h2> Celery</h2>-->
<!--</div>-->
<!--</section>-->

<section class="slide">
<iframe src="http://nbviewer.ipython.org/6574021"></iframe>
</section>


<section class="slide">
<div>
<h2><strong>Weak</strong> Scaling</h2>
Compare: mpi4py, IPython Parallel, Celery
<br>
What recommendations can we offer?

<br>
Best case scenario
<ul>
<li>Small messages, limited file IO, sleep</li>
</ul>

<p>Weak scaling</p>
<ul><li>task = 10 * number of cores</li>
<li>up to 12,288 cores</li>
<li>time uniform(27,33) seconds</li>
</ul>
</div>
</section>

<section class="slide">
<div>
<h2>Initialization</h2>
<img src="img/pres_init_time.png" style="margin:5px auto; height:500px; display:block;"  alt="some_text">		
</div>
</section>

<section class="slide">
<div>
<h2>Weak scaling time</h2>
<img src="img/pres_time.png" style="margin:5px auto; height:500px; display:block;">	
</div>
</section>

<section class="slide">
<div>
<h2>Weak scaling efficiency</h2>
<img src="img/pres_efficiency.png" style="margin:5px auto; height:500px; display:block;">	
</div>
</section>

<section class="slide">
<div>
<h2> Compare </h2>
<table class="table table-bordered">
	<tr class="success">
		   <td>mpi4py</td>
	    <td>many cores, not fault-tolerant</td> 
	</tr>
	<tr class="success">
	    <td>IPython</td>
	    <td>100 cores, fault-tolerant</td>
	</tr>
	<tr class="success">
	    <td>IPython</td>
	    <td>many cores, fault-tolerant, consistent time</td>
	</tr>
	<tr class="warning">
	    <td>Celery</td>
	    <td>many cores, fault-tolerant, variable time</td>
	</tr>
	<tr class="success">
	    <td>Multiprocessing</td>
	    <td>single-node</td>
	</tr>
</table>

<p>Issues</p>
<table class="table table-bordered">
	<tr class="error">
	    <td>IPython, Celery</td>
	    <td>launching</td>
	</tr>
	<tr class="error">
	    <td>all</td>
	    <td>user abstraction</td>
	</tr>
</table>
</div>
</section>	


<section class="slide">
<div>
<h2>Conclusions</h2>
<p>Python is an excellent way to manage MTC jobs</p>
<p>Python provides great <strong>abstraction</strong></p>
<p>IPython and Celery </p>
<ul>
	<li><strong>elastic</strong>, memory, fault-tolerant</li>
</ul>

<p>Moving forward</p>
<ul>
	<li> Simple interface for MTC</li>	
	<li> Realistic tasks </li>
</ul>			
</div>
</section>


<section class="slide">
<div>
<h2>References</h2>

<strong>paper</strong> 
<p style="font-size: 18px;">
<em>Scaling of Many-Task Computing Approaches in Python on Cluster Supercomputers</em> <br>Monte Lunacek <em>et al.</em>
IEEE Cluster 2013</p>

<p><strong>tutorials</strong> 
<img src="img/meetup.png" style="margin:0; height:70px; display:block;">	
<a href="http://www.meetup.com/University-of-Colorado-Computational-Science-and-Engineering/">Univeristy of Colorado Computational Science and Engineering</a>	
<p><strong>slides and code</strong> 
<br>
<a href="https://github.com/mlunacek/data_science_meetup_2013">https://github.com/mlunacek/data_science_meetup_2013</a></p>

</div>
</section>
	

<section class="slide shout">
	<div>
		<h2>Thanks!</h2>
	</div>
</section>



	<!-- end of slides -->
	</div></div>
	<script src="js/shower.min.js"></script>
</body>
</html>
